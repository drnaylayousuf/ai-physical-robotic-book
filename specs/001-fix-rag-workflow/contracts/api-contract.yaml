# API Contract: RAG Chatbot API with Qdrant and Gemini Integration

## Overview
This document describes the API contract for the RAG chatbot system that integrates with Qdrant for retrieval and Gemini for response generation.

## API Endpoint: /api/ask

### HTTP Method
POST

### Description
Accepts a user question and returns a response based on the RAG (Retrieval-Augmented Generation) system using Qdrant for context retrieval and Gemini for answer generation.

### Request

#### Headers
- `Content-Type: application/json`
- `Accept: application/json`

#### Body
```json
{
  "question": "string (required)",
  "mode": "string (optional, default: 'full_book')",
  "selected_text": "string (optional, required for 'selected_text' mode)"
}
```

#### Example Request
```json
{
  "question": "What are the main components of humanoid robots?",
  "mode": "full_book"
}
```

#### Example Request for Selected Text Mode
```json
{
  "question": "What does this text explain about sensors?",
  "mode": "selected_text",
  "selected_text": "Humanoid robots use various sensors including cameras, accelerometers, and gyroscopes to perceive their environment..."
}
```

### Response

#### Success Response (200 OK)
```json
{
  "response": "string",
  "sources": [
    {
      "chunk_id": "string",
      "content": "string",
      "score": "number",
      "source": "string"
    }
  ],
  "references": ["string"],
  "timestamp": "ISO 8601 datetime string"
}
```

#### Error Response (400 Bad Request)
```json
{
  "error": "string",
  "details": "string"
}
```

#### Example Success Response
```json
{
  "response": "Humanoid robots typically include sensors, actuators, control systems, and power sources as main components...",
  "sources": [
    {
      "chunk_id": "robotics-intro-001",
      "content": "The fundamental components of humanoid robots include sensory systems, actuation mechanisms, and control architectures...",
      "score": 0.85,
      "source": "chapter_1_introduction.md"
    }
  ],
  "references": ["chapter_1_introduction.md", "chapter_3_design_principles.md"],
  "timestamp": "2025-12-11T10:30:00Z"
}
```

## Diagnostic Endpoint: /api/diagnostic/qdrant

### HTTP Method
GET

### Description
Provides diagnostic information about the Qdrant collection status and content for troubleshooting purposes.

### Response

#### Success Response (200 OK)
```json
{
  "collections": ["string"],
  "total_chunks": "number",
  "sample_chunks": [
    {
      "chunk_id": "string",
      "content": "string",
      "source": "string"
    }
  ],
  "status": "string"
}
```

#### Example Success Response
```json
{
  "collections": ["book_chunks"],
  "total_chunks": 1250,
  "sample_chunks": [
    {
      "chunk_id": "robotics-intro-001",
      "content": "The fundamental components of humanoid robots include sensory systems...",
      "source": "chapter_1_introduction.md"
    }
  ],
  "status": "healthy"
}
```

## CORS Configuration

### Allowed Origins
- `http://localhost:3000` (development)
- Production origin (to be specified)

### Allowed Methods
- `GET`
- `POST`
- `OPTIONS`

### Allowed Headers
- `Content-Type`
- `Authorization`
- `X-Requested-With`

### Credentials
- `allow_credentials: true` (if authentication is implemented)